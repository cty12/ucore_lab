# Lab 3 Report

## Exercise 0

仍然是使用 meld 完成半自动移植。

## Exercise 1

### 实验原理

首先判断一个虚地址是否有对应的物理地址。若没有，就要分配页，并建立物理地址和逻辑地址之间的联系；若有，就要从磁盘将这个 page 换入(swap-in)，并建立好物理地址和逻辑地址间的映射。

### 思考问题

> 请描述页目录项 (PDE) 和页表项 (PTE) 中组成部分对 ucore 实现页替换算法的潜在用处。

在 PDE 和 PTE flags 中有 PTE_\A （访问位）和 PTE\_D （修改位，或者叫脏位），两者在下文所述的 extended clock 算法中有用到。

> 如果 ucore 的缺页服务例程在执行过程中访问内存出现了页访问异常，请问硬件要做哪些事情？

保护现场，保存寄存器的值和堆栈等运行状态信息，然后转到异常处理代码入口交给操作系统的页访问异常程序处理；处理完毕后，恢复现场继续执行即可。

## Exercise 2

### 实验原理

维护一个队列，每次新加入的页都添加在队首。旧的页从队尾出队，这就是 FIFO 算法。

### 思考问题

> 如果要在ucore上实现"extended clock页替换算法，请给你的设计方案，现有的swap_manager框架是否足以支持在ucore中实现此算法？如果是，请给你的设计方案。如果不是，请给出你的新的扩展和基此扩展的设计方案。并需要回答如下问题：1. 需要被换出的页的特征是什么？2. 在 ucore 中如何判断具有这样特征的页？3. 何时进行换入和换出操作？

可以在 PTE 里设置两位分别表示页是否被访问过（访问位）和是否被修改过（修改位）。

换出的页的特征是访问位和修改位都是 0 。只需要沿着循环链表依次查找，判断 PTE 中的这两位的值就可以了。

换入操作在 page fault 的时候进行；换出是在 page fault 且没有空闲页的情况下进行。

## 小结

按照注释给出的提示即可顺利进行实验。代码和参考答案只有细节上的差异，例如一些 assert 没有做，可能会有安全性的问题。
